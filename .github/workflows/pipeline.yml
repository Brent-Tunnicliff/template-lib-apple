# Copyright Â© 2025 Brent Tunnicliff <brent@tunnicliff.dev>

name: Pipeline

on:
  push:
  workflow_dispatch:

jobs:
  pipeline:
    runs-on: macos-15
    strategy:
      matrix:
        target: [
          { platform: "iOS", simulator_version: "18" },
          { platform: "macOS", simulator_version: "" },
          { platform: "tvOS", simulator_version: "18" },
          { platform: "watchOS", simulator_version: "11" },
          { platform: "visionOS", simulator_version: "2" }
        ]
    steps:
      - name: List installed simulators
        run: xcrun simctl list devices

      - id: destination
        uses: Brent-Tunnicliff/action-xcodebuild-destination-apple@v1
        with:
          platform: "${{ matrix.target.platform }}"
          simulator_version: "${{ matrix.target.simulator_version }}"

      - uses: actions/checkout@v4

      - name: Set Xcode version
        run: sudo xcode-select -s "/Applications/Xcode_16.4.app"

      # Making a build manually to test destination is working.
      - name: Build Debug
        run: xcodebuild build
          -workspace "Package.xcworkspace"
          -scheme "REPLACE_ME"
          -destination "${{ steps.destination.outputs.destination }}"
          -configuration "Debug"
          -skipPackagePluginValidation
          CODE_SIGN_IDENTITY=""
          CODE_SIGNING_REQUIRED=NO